fileVersion: 1
id: a6dc90f9-43ce-4d02-bb61-37916bfbe335
name: STG_TRANSACTIONS_TEST
operation:
  config:
    insertStrategy: INSERT
    postSQL: ""
    preSQL: ""
    testsEnabled: true
    truncateBefore: true
  database: ""
  deployEnabled: true
  description: ""
  isMultisource: false
  locationName: TARGET_NOT_NULL
  materializationType: table
  metadata:
    appliedNodeTests: []
    columns:
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e9eeee81-fe05-441b-9db1-4babcd774664
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: meta_currency
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: b6c363e8-26cf-40fd-a019-0cbc49df7005
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 2c7c2731-3dfe-4ac3-ab3d-c3f64045a928
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: meta_exchange
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3921c976-2eaf-49cc-adbb-5b588893658c
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: c82f12cf-3c02-4ffb-9591-e932dae28613
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: meta_exchange_timezone
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: cab70f2e-eb90-4f56-85f7-c3b8c5c53366
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: e334dbf5-82cf-4290-9081-95c35cb7faea
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: meta_interval
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 31f8f1cb-97b1-4f35-9af9-26986d5ed48c
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: eec4a6df-5824-4021-b6a4-cec32c439390
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: meta_mic_code
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a3342f26-dfe1-4853-8599-8f57d38cbd2e
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: aeb13f14-bebd-46d0-a2de-da471025f309
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: meta_symbol
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: fd0dc724-53ef-4b01-992e-4caae10c2f7c
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 374d1392-205d-4c17-b067-6666f94199e8
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: meta_type
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: e040599b-9d99-4b9a-85c2-2287cb5c1e03
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 87f145c2-9be1-4a1e-9b5b-19fbba9b0c03
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: status
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: c0698eee-bc1b-4019-9ff4-768bfad5d650
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 15313973-bb0d-4583-8415-91f509200c77
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: values_close
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 6fb64201-8eea-46cd-afe2-d7f3f6f123aa
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 4a66a724-a42c-4fef-be22-21015b95c629
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: values_datetime
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 2917b4c1-eb0d-44fd-a0e8-edf1c500eb89
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 9398e2e7-7bca-4e68-8e77-53684e8a7496
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: values_high
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 52d82428-eca1-4590-9aa7-f5f1c014b402
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: d4b1a9a2-c7b5-486a-aa72-54157ea38b8d
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: values_low
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a6a7716a-7f23-41db-816e-333e0900cd88
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a195e5e6-c1f0-44dc-a10b-46177a8fdf74
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: values_open
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: a8108dae-c72f-4505-97b1-d1afbf077092
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: a327a745-d0e4-4943-a31b-d0342c0900d2
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: values_volume
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 3db93676-aee6-451d-bf71-8b1244bf9cae
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: ed84e440-ada4-4973-937e-1e0f20cac2dc
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: meta_currency_base
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 027c5d63-89af-4092-b49d-b147e0657c39
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
      - appliedColumnTests: {}
        columnReference:
          columnCounter: 486772fa-89a8-4f96-88b2-9c86ad18aaa2
          stepCounter: a6dc90f9-43ce-4d02-bb61-37916bfbe335
        config: {}
        dataType: STRING
        description: ""
        name: meta_currency_quote
        nullable: true
        sourceColumnReferences:
          - columnReferences:
              - columnCounter: 112a77eb-e707-42c4-86e7-426c539f39d4
                stepCounter: f49b0191-0e6e-467c-9efb-d49e3d52197a
            transform: ""
    cteString: ""
    enabledColumnTestIDs: []
    sourceMapping:
      - aliases: {}
        customSQL:
          customSQL: ""
        dependencies:
          - locationName: TARGET
            nodeName: STG_RAW_CRYPTO_TEST
          - locationName: TARGET
            nodeName: STG_RAW_ETFS_TEST
          - locationName: TARGET
            nodeName: STG_RAW_FOREX_TEST
          - locationName: TARGET
            nodeName: STG_RAW_STOCKS_TEST
        join:
          joinCondition: |
            {% set column_mapping = {
                "meta_currency_base": "CURRENCY_BASE",
                "meta_currency_quote": "CURRENCY_QUOTE",
                "values_volume": "TRADE_VOLUME",
                "values_open": "OPEN_PRICE",
                "values_low": "LOW_PRICE",
                "values_high": "HIGH_PRICE",
                "values_datetime": "DATE_TRANSACTION",
                "values_close": "CLOSE_PRICE",
                "status": "STATUS",
                "meta_type": "ASSET_TYPE",
                "meta_symbol": "SYMBOL",
                "meta_mic_code": "MIC_CODE",
                "meta_interval": "INTERVAL",
                "meta_exchange_timezone": "EXCHANGE_TIMEZONE",
                "meta_exchange": "EXCHANGE_NAME",
                "meta_currency": "CURRENCY"
            } %}

            SELECT
              {% for old_col, new_col in column_mapping.items() %}
                {{ old_col }} AS {{ new_col }}{% if not loop.last %}, {% endif %}
              {% endfor %}
            FROM 
              {{ ref('TARGET', 'STG_RAW_STOCKS_TEST') }}

            UNION ALL

            SELECT
              {% for old_col, new_col in column_mapping.items() %}
                {{ old_col }} AS {{ new_col }}{% if not loop.last %}, {% endif %}
              {% endfor %}
            FROM
              {{ ref('TARGET', 'STG_RAW_FOREX_TEST') }}

            UNION ALL

            SELECT
              {% for old_col, new_col in column_mapping.items() %}
                {{ old_col }} AS {{ new_col }}{% if not loop.last %}, {% endif %}
              {% endfor %}
            FROM
              {{ ref('TARGET', 'STG_RAW_CRYPTO_TEST') }}

            UNION ALL

            SELECT
              {% for old_col, new_col in column_mapping.items() %}
                {{ old_col }} AS {{ new_col }}{% if not loop.last %}, {% endif %}
              {% endfor %}
            FROM
              {{ ref('TARGET', 'STG_RAW_ETFS_TEST') }};
        name: STG_TRANSACTIONS_TEST
        noLinkRefs: []
  name: STG_TRANSACTIONS_TEST
  overrideSQL: false
  schema: ""
  sqlType: Stage
  type: sql
  version: 1
type: Node
